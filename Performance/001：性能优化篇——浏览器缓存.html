<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>能不能说一说浏览器缓存 | 前端时光屋</title>
    <meta name="description" content="梁书豪的博客">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/assets/img/head.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.83ce72a3.css" as="style"><link rel="preload" href="/assets/js/app.06b24de5.js" as="script"><link rel="preload" href="/assets/js/2.a05443f6.js" as="script"><link rel="preload" href="/assets/js/61.2cdcce13.js" as="script"><link rel="prefetch" href="/assets/js/10.a5eaa95a.js"><link rel="prefetch" href="/assets/js/11.06e35382.js"><link rel="prefetch" href="/assets/js/12.140f4db6.js"><link rel="prefetch" href="/assets/js/13.f2fcf962.js"><link rel="prefetch" href="/assets/js/14.e39a2df6.js"><link rel="prefetch" href="/assets/js/15.b07ecf86.js"><link rel="prefetch" href="/assets/js/16.949e4dac.js"><link rel="prefetch" href="/assets/js/17.6a721f97.js"><link rel="prefetch" href="/assets/js/18.1b363edf.js"><link rel="prefetch" href="/assets/js/19.900530d5.js"><link rel="prefetch" href="/assets/js/20.e9f183ae.js"><link rel="prefetch" href="/assets/js/21.6c08f73f.js"><link rel="prefetch" href="/assets/js/22.c37ad609.js"><link rel="prefetch" href="/assets/js/23.759a99ff.js"><link rel="prefetch" href="/assets/js/24.c8f3fa94.js"><link rel="prefetch" href="/assets/js/25.b58c3ab8.js"><link rel="prefetch" href="/assets/js/26.ba5e0c3b.js"><link rel="prefetch" href="/assets/js/27.ad23a71d.js"><link rel="prefetch" href="/assets/js/28.a74c53ca.js"><link rel="prefetch" href="/assets/js/29.30ef0dde.js"><link rel="prefetch" href="/assets/js/3.a21791ca.js"><link rel="prefetch" href="/assets/js/30.1e9ebdb5.js"><link rel="prefetch" href="/assets/js/31.30b7a1e3.js"><link rel="prefetch" href="/assets/js/32.9f1ded02.js"><link rel="prefetch" href="/assets/js/33.61ac7552.js"><link rel="prefetch" href="/assets/js/34.f040c739.js"><link rel="prefetch" href="/assets/js/35.2c5d08d5.js"><link rel="prefetch" href="/assets/js/36.257c41df.js"><link rel="prefetch" href="/assets/js/37.40a1bbc2.js"><link rel="prefetch" href="/assets/js/38.5415ab64.js"><link rel="prefetch" href="/assets/js/39.90b605f0.js"><link rel="prefetch" href="/assets/js/4.21591d40.js"><link rel="prefetch" href="/assets/js/40.5e9ae863.js"><link rel="prefetch" href="/assets/js/41.884155d7.js"><link rel="prefetch" href="/assets/js/42.1ec6dd60.js"><link rel="prefetch" href="/assets/js/43.47cf7283.js"><link rel="prefetch" href="/assets/js/44.7af49fad.js"><link rel="prefetch" href="/assets/js/45.6088e1a9.js"><link rel="prefetch" href="/assets/js/46.fd004b63.js"><link rel="prefetch" href="/assets/js/47.044fc351.js"><link rel="prefetch" href="/assets/js/48.55a5f3fb.js"><link rel="prefetch" href="/assets/js/49.e103d7ad.js"><link rel="prefetch" href="/assets/js/5.db726197.js"><link rel="prefetch" href="/assets/js/50.f945ce05.js"><link rel="prefetch" href="/assets/js/51.316d410a.js"><link rel="prefetch" href="/assets/js/52.92a10b4a.js"><link rel="prefetch" href="/assets/js/53.e7534ba4.js"><link rel="prefetch" href="/assets/js/54.6b19fef9.js"><link rel="prefetch" href="/assets/js/55.e3fc3b29.js"><link rel="prefetch" href="/assets/js/56.0e152b3e.js"><link rel="prefetch" href="/assets/js/57.13187b13.js"><link rel="prefetch" href="/assets/js/58.d9bda000.js"><link rel="prefetch" href="/assets/js/59.da580bc1.js"><link rel="prefetch" href="/assets/js/6.ecb72c20.js"><link rel="prefetch" href="/assets/js/60.285d6cbd.js"><link rel="prefetch" href="/assets/js/62.cf643bd2.js"><link rel="prefetch" href="/assets/js/63.137e165f.js"><link rel="prefetch" href="/assets/js/64.ce851e8d.js"><link rel="prefetch" href="/assets/js/65.8e7d5299.js"><link rel="prefetch" href="/assets/js/66.4369c90e.js"><link rel="prefetch" href="/assets/js/67.c769b698.js"><link rel="prefetch" href="/assets/js/68.bf74184c.js"><link rel="prefetch" href="/assets/js/69.17c602b3.js"><link rel="prefetch" href="/assets/js/7.6cbb1600.js"><link rel="prefetch" href="/assets/js/70.55df3357.js"><link rel="prefetch" href="/assets/js/71.4fccac4a.js"><link rel="prefetch" href="/assets/js/72.d4eeaf2a.js"><link rel="prefetch" href="/assets/js/73.30f9528a.js"><link rel="prefetch" href="/assets/js/74.4e91b153.js"><link rel="prefetch" href="/assets/js/75.cbd8b825.js"><link rel="prefetch" href="/assets/js/76.72f7b4b9.js"><link rel="prefetch" href="/assets/js/77.a30e1989.js"><link rel="prefetch" href="/assets/js/78.3c4b8b32.js"><link rel="prefetch" href="/assets/js/79.0897d95d.js"><link rel="prefetch" href="/assets/js/8.36911a7c.js"><link rel="prefetch" href="/assets/js/80.43c8044b.js"><link rel="prefetch" href="/assets/js/81.89c13b3c.js"><link rel="prefetch" href="/assets/js/82.df5cf081.js"><link rel="prefetch" href="/assets/js/83.885deed2.js"><link rel="prefetch" href="/assets/js/84.4ed1e2fa.js"><link rel="prefetch" href="/assets/js/85.8bade5eb.js"><link rel="prefetch" href="/assets/js/86.d39c8dda.js"><link rel="prefetch" href="/assets/js/87.15d43505.js"><link rel="prefetch" href="/assets/js/88.ee14fb59.js"><link rel="prefetch" href="/assets/js/89.c5ea7888.js"><link rel="prefetch" href="/assets/js/9.6d6cea10.js"><link rel="prefetch" href="/assets/js/90.2e83c22b.js"><link rel="prefetch" href="/assets/js/91.972a9ec4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.83ce72a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端时光屋</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/basics/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/advance/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><a href="/Vue/base/" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/React/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/Node/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Webpack" class="dropdown-title"><span class="title">Webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Webpack/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/Webpack/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><a href="/Performance/" class="nav-link router-link-active">
  性能相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><span class="title">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Interview/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/Interview/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/Interview/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/Interview/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/Interview/http/" class="nav-link">
  http
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/basics/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/advance/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><a href="/Vue/base/" class="nav-link">
  Vue
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/React/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/React/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/Node/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Webpack" class="dropdown-title"><span class="title">Webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Webpack/basics/" class="nav-link">
  用法
</a></li><li class="dropdown-item"><!----> <a href="/Webpack/advance/" class="nav-link">
  原理
</a></li></ul></div></div><div class="nav-item"><a href="/Performance/" class="nav-link router-link-active">
  性能相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试相关" class="dropdown-title"><span class="title">面试相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Interview/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/Interview/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/Interview/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/Interview/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/Interview/http/" class="nav-link">
  http
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端性能相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Performance/001：性能优化篇——浏览器缓存.html" class="active sidebar-link">001：性能优化篇——浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#缓存分类" class="sidebar-link">缓存分类</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#缓存位置" class="sidebar-link">缓存位置</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#缓存检查" class="sidebar-link">缓存检查</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#强缓存" class="sidebar-link">强缓存</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#协商缓存" class="sidebar-link">协商缓存</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#两者对比" class="sidebar-link">两者对比</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#缓存请求的基本流程" class="sidebar-link">缓存请求的基本流程</a></li><li class="sidebar-sub-header"><a href="/Performance/001：性能优化篇——浏览器缓存.html#图解浏览器整个缓存流程" class="sidebar-link">图解浏览器整个缓存流程</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="能不能说一说浏览器缓存"><a href="#能不能说一说浏览器缓存" class="header-anchor">#</a> 能不能说一说浏览器缓存</h1> <p>缓存是性能优化中非常重要的一环，浏览器的缓存机制对开发也是非常重要的知识点。接下来以三个部分来把浏览器的缓存机制说清楚：</p> <ul><li>缓存分类 和 缓存位置</li> <li>强缓存</li> <li>协商缓存</li></ul> <h2 id="缓存分类"><a href="#缓存分类" class="header-anchor">#</a> 缓存分类</h2> <p>web缓存分为很多种，比如<b>数据库缓存、代理服务器缓存、还有我们熟悉的CDN缓存</b></p>
浏览器向源服务器发起请求的流程如下：
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghm0x33ecsj313o06e0ti.jpg" alt=""></p> <p><b>浏览器缓存是将文件保存在客户端</b>，在同一个会话过程中会检查缓存的副本是否足够新，在后退网页时，访问过的资源可以从浏览器缓存中拿出使用。通过减少服务器处理请求的数量，提高性能。</p> <h2 id="缓存位置"><a href="#缓存位置" class="header-anchor">#</a> 缓存位置</h2> <blockquote><p><strong>Memory Cache</strong>：内存缓存 （当前浏览器窗口关闭了，也就是失效了）</p> <p><strong>Disk Cache</strong>：硬盘缓存</p></blockquote> <p>说到<strong>浏览器缓存</strong>的缓存位置，并不是把缓存存在浏览器里，而是浏览器自己建立一些缓存机制，把缓存信息存储到<strong>内存条</strong>里（暂时缓存），比如打开某个页面，执行某个js脚本的时候，会在<strong>内存条</strong>里，开辟一些栈空间，用于执行代码，当页面关闭后，有的内存就会被释放，有的内存就会造成泄漏问题，不会被释放。</p> <p>然而，浏览器还会把一些内存信息存到<strong>硬盘</strong>里，存到硬盘里的信息，并不会因为断电而丢失掉。</p> <h2 id="缓存检查"><a href="#缓存检查" class="header-anchor">#</a> 缓存检查</h2> <h4 id="浏览器缓存一般在什么时刻被查找并获取呢？"><a href="#浏览器缓存一般在什么时刻被查找并获取呢？" class="header-anchor">#</a> 浏览器缓存一般在什么时刻被查找并获取呢？</h4> <p>一般在我们打开浏览器输入一个网页的时候，浏览器并不会立即向服务器发送请求，而是先检查本地是否有缓存，如果有缓存，则直接从缓存中读取；没有缓存时，才向服务器发送请求，拿到最新信息。</p> <h3 id="检查缓存的一些场景"><a href="#检查缓存的一些场景" class="header-anchor">#</a> 检查缓存的一些场景</h3> <ul><li>打开网页：查找<strong>disk cache</strong>中是否有匹配，如果有则使用，如没有则发送网络请求</li> <li>普通刷新(F5)：因Tab没关闭，因为<strong>memory cache</strong>是可用的，会被优先使用，其次才是<strong>disk cache</strong></li> <li>强制刷新(Ctrl + F5)：浏览器<strong>不使用缓存</strong>，因此发送的请求头部均带有<strong>Cache-control: no-cache</strong>，服务器直接返回200和最新内容</li></ul> <h2 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h2> <p>浏览器中的缓存作用分为两种情况，一种是<strong>需要发送 HTTP 请求</strong>，一种是<strong>不需要发送请求</strong>。</p> <p>首先是检查强缓存，这个阶段不需要发送 <strong>HTTP</strong> 请求。</p> <h3 id="检查强缓存机制的流程"><a href="#检查强缓存机制的流程" class="header-anchor">#</a> 检查强缓存机制的流程</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gi8xrf8j8vj31ca0tw42n.jpg" alt="打开网页，第一次校验强缓存流程"></p> <blockquote><p>强缓存的执行流程，第一次发送请求的时候，就如图上的<strong>5个步骤</strong>，不再详细描述</p></blockquote> <p>上图是打开网页，第一次校验强缓存的流程，那么第二次呢？</p> <blockquote><p>第二次再请求该页面的时候，会<strong>查浏览器缓存的结果和标识</strong>，如果有强缓存的标识，那么直接从<strong>浏览器缓存</strong>中读取</p></blockquote> <p>上面便是，完整的强缓存机制。</p> <p>如何来检查呢？通过相应的字段来进行，但是说起这个字段就有点门道了。</p> <p>在 <strong>HTTP/1. 0</strong> 和 <strong>HTTP/1. 1</strong> 当中，这个字段是不一样的。</p> <blockquote><p>在 <strong>HTTP/1. 0</strong> 时期，使用的是<b>Expires</b>，而 <strong>HTTP/1. 1</strong> 使用的是<b>Cache-Control</b>。</p></blockquote> <p>让我们首先来看看<strong>Expires</strong>。</p> <h3 id="expires"><a href="#expires" class="header-anchor">#</a> Expires</h3> <p><strong>Expires</strong> 即<b>过期时间</b>，存在于服务端返回的响应头中，告诉浏览器在这个过期时间 <strong>之前</strong> 可以直接从浏览器的缓存里面获取数据，无需再次请求。比如下面这样:</p> <div class="language-js extra-class"><pre class="language-js"><code>Expires<span class="token operator">:</span> Wed<span class="token punctuation">,</span> <span class="token number">22</span> Nov <span class="token number">2019</span> <span class="token number">08</span><span class="token operator">:</span> <span class="token number">41</span><span class="token operator">:</span> <span class="token number">00</span> <span class="token constant">GMT</span>
</code></pre></div><p>表示资源在2019年11月22号8点41分过期，过期了就得向服务端发请求。<br><br>
这个方式看上去没什么问题，合情合理，但其实潜藏了一个坑，那就是<b><strong>服务器的时间和浏览器的时间可能并不一致</strong></b>，那服务器返回的这个过期时间可能就是 <strong>不准确</strong> 的。因此这种方式很快在后来的HTTP1. 1版本中被抛弃了。</p> <h3 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h3> <p>在HTTP1. 1中，采用了一个非常关键的字段： <strong>Cache-Control</strong> 。这个字段也是存在于服务端返回的响应头中。<br><br>
它和 <strong>Expires</strong> 本质的不同在于它并没有采用具体的 <strong>过期时间点</strong> 这个方式，而是采用 <strong>过期时长</strong> 来控制缓存，对应的字段是max-age。比如这个例子:</p> <div class="language-js extra-class"><pre class="language-js"><code>代表这个响应返回后在 <span class="token number">3600</span> 秒， 也就是一个小时之内可以直接使用缓存
Cache <span class="token operator">-</span> Control<span class="token operator">:</span> max <span class="token operator">-</span> age <span class="token operator">=</span> <span class="token number">3600</span>
</code></pre></div><p>如果你觉得它只有max-age一个属性的话，那就大错特错了。</p> <p>它其实可以组合非常多的指令，完成更多场景的缓存判断, 将一些关键的属性列举如下: </p> <br> <p><b>max-age(单位为s)</b>： <strong>指定设置缓存最大的有效时间，定义的时时间长短</strong> 。当浏览器向服务器发送请求后，在max-age这段时间里浏览器就不会在向服务器发送请求了。优先于 <strong>Expires</strong> <br><br> <b>public 指定响应会被缓存，并且在多用户间共享</b>： <strong>客户端</strong> 和 <strong>代理服务器</strong> 都可以缓存。因为一个请求可能要经过不同的 <strong>代理服务器</strong> 最后才到达目标服务器，那么结果就是不仅仅浏览器可以缓存数据，中间的任何代理节点都可以进行缓存。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghm1wl7mqaj30f1084t9g.jpg" alt=""> <br><br> <b>private</b>：这种情况就是只有浏览器能缓存了，中间的代理服务器不能缓存。
<br><br> <b>no-cache</b>：跳过当前的 <strong>强缓存</strong> ，强制发送 <strong>HTTP</strong> 请求，即直接进入 <strong>协商缓存</strong> 的阶段。
<br><br> <b>no-store</b>：禁止一切缓存（这才是响应不被缓存的意思）。
<br><br> <b>s-maxage（只用于共享缓存，如CDN缓存）</b>：这和 <strong>max-age</strong> 长得比较像，但是区别在于s-maxage是针对 <strong>代理服务器</strong> 的缓存时间。比如，当x-maxage=60时，即使更新了CDN的内容，浏览器也不会请求。
<br><br></p> <blockquote><p>值得注意的是：
当<B>Expires</B>和<b>Cache-Control</b>同时存在的时候，<strong>Cache-Control</strong>会优先考虑。</p></blockquote> <h3 id="强缓存的特点"><a href="#强缓存的特点" class="header-anchor">#</a> 强缓存的特点</h3> <p>服务器设定了一些<strong>资源(静态资源/css/js/图片...)<strong>的“强缓存机制”，在浏览器缓存的有效期内，我们除了</strong>强制清缓存刷新</strong>外，正常加载页面，都是从<strong>强缓存</strong>中获取数据，而不是从服务器获取。</p> <h3 id="强缓存的优势与弊端"><a href="#强缓存的优势与弊端" class="header-anchor">#</a> 强缓存的优势与弊端</h3> <blockquote><p>强缓存的优势：</p> <p><strong>减少对服务器的请求次数，加载资源更快，页面渲染速度更快</strong></p></blockquote> <blockquote><p>强缓存的弊端：</p> <p>​	<strong>当我们的资源在服务器更新了，但是本地还是有缓存的，这样导致客户端无法及时获取最新的资源</strong></p></blockquote> <blockquote><p>避免强缓存带来的缺陷：</p> <ul><li><strong>首页HTML</strong>不做缓存，每一次发布资源的时候，内容有更新（资源文件名字不一样，例如webpack 在名字上设置 <strong>HASH</strong>），这样页面请求的资源文件也就变了，客户端没有新文件的缓存，就从服务器获取了</li> <li>哪怕文件名不变，只要在请求资源文件的后面加一个<strong>时间戳</strong>也是可以的，时间戳不同，从<strong>服务器重新获取资源</strong></li> <li>不做强缓存的设置，基于协商缓存实现（<strong>真实项目中，往往 两者同时 设置</strong>）</li></ul></blockquote> <p>当然，还存在一种情况，当资源缓存时间超时了，也就是 <strong>强缓存失效</strong> 了，接下来怎么办？没错，这样就进入到第二级屏障——协商缓存了。</p> <h2 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h2> <p>强缓存失效之后，浏览器在请求头中携带相应的 <strong>缓存tag</strong> 来向服务器 <strong>发请求</strong> ，由服务器根据这个tag，来决定是否使用缓存。<br></p> <p>在 <strong>HTTP/1. 0</strong> 和 <strong>HTTP/1. 1</strong> 当中，这个字段是不一样的。</p> <blockquote><p>在 <strong>HTTP/1. 0</strong> 时期，使用的是<b>Last-Modifed</b>，而 <strong>HTTP/1. 1</strong> 使用的是<b>Etag</b>。</p></blockquote> <h3 id="检查协商缓存机制的流程"><a href="#检查协商缓存机制的流程" class="header-anchor">#</a> 检查协商缓存机制的流程</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gi8z39pev4j30wk0q8wjc.jpg" alt="检查协商缓存机制的流程"></p> <blockquote><p>协商缓存流程 <strong>Last-Modified和If-Modified-Since</strong></p></blockquote> <blockquote><ul><li>第一次访问资源，服务器返回资源的同时，响应头中设置<strong>Last-Modified</strong>（服务器上的最后修改时间）, 浏览器接收后，缓存文件和响应头；</li> <li>下一次请求这个资源，浏览器检测到有<strong>Last-Modified</strong>，于是添加<strong>If-Modified-Since</strong>请求头，值就是<strong>Last-Modified</strong>中的值；</li> <li>服务器再次收到这个资源请求，会根据 <strong>If-Modified-Since</strong> 中的值与服务器中这个资源的最后修改时间对比，如果没有变化，返回304和空的响应体，直接从缓存读取，如果<strong>If-Modified-Since</strong>的时间小于服务器中这个资源的最后修改时间，说明文件有更新，于是返回新的资源文件和200；</li></ul></blockquote> <p>但是<strong>Last-Modified 只能以秒计时</strong>，如果在不可感知的时间内修改完成文件，那么服务端会认为资源还是命中了，不会返回正确的资源；</p> <div class="custom-block tip"><p class="custom-block-title">协商缓存流程 ETag 和 If-None-Match</p></div> <ul><li><p><strong>Etag是服务器响应请求时</strong>，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，Etag就会重新生成；</p></li> <li><p>下一次加载资源向服务器发送请求时，会将上一次返回的<strong>Etag</strong>值放到请求头If-None-Match里，服务器只需要比较客户端传来的<strong>If-None-Match</strong>跟自己服务器上该资源的<strong>ETag</strong>是否一致，就能很好地判断资源相对客户端而言是否被修改过了。</p> <ul><li><strong>ETag匹配失败</strong>：服务器返回常规 GET 200的形式，将 最新的资源发给客户端</li> <li><strong>ETag匹配一致</strong>：返回304，直接读取本地缓存</li></ul></li></ul> <h3 id="last-modified"><a href="#last-modified" class="header-anchor">#</a> Last-Modified</h3> <p>即是 <strong>服务器文件的最后修改时间</strong> 。在浏览器第一次给服务器发送请求后，服务器会在响应头中加上这个字段。<br><br>
当浏览器接收到后，如果再次请求，会在请求头中携带 <strong>If-Modified-Since</strong> 字段，询问 <strong>Last-Modifed</strong> 时间之后资源是否被修改过</p> <ul><li>如果没有被修改过，则返回状态码304，——使用协商缓存</li> <li>如果修改过，则再去服务器请求资源，返回码和首次请求的相同为200，资源为服务器最新资源</li></ul> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghm2fmsii9j30au06fdgi.jpg" alt=""></p> <h3 id="etag"><a href="#etag" class="header-anchor">#</a> ETag</h3> <p><strong>Etag</strong> 是服务器根据当前文件的内容，给文件生成的唯一标识，只要里面的内容有改动，这个值就会变。服务器通过 <strong>响应头</strong> 把这个值给浏览器。
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghm2o8u52ej30fu084dgy.jpg" alt=""></p> <h2 id="两者对比"><a href="#两者对比" class="header-anchor">#</a> 两者对比</h2> <ol><li><p>在 <strong>精确度</strong> 上， <strong>ETag</strong> 优于 <strong>Last-Modified</strong> 。ETag是按照内容给资源上标识，因为能准确感知资源的变化。而Last-Modified就不一样了，它在一些情况是不能准确感知到资源变化的</p> <ul><li><strong>编辑</strong> 了资源文件，但是文件内容并没有更改，这样也会造成缓存失效。</li> <li><strong>Last-Modified</strong> 能够感知的单位时间是秒，如果文件在1秒内改变了很多次，那么这时候的<strong>Last-Modified</strong>并没有体现出修改了。</li></ul></li> <li><p>在 <strong>性能上</strong> ， <strong>Last-Modified</strong> 优于 <strong>ETag</strong> ，也很简单理解， <strong>Last-Modified</strong> 仅仅是记录一个时间点，而 <strong>ETag</strong> 需要根据文件的具体内容生成哈希值。</p></li></ol> <br>
另外，如果两种方式都支持的话，服务器会优先考虑 **ETag** 的。
<blockquote><p>强缓存： <code>本地有缓存则不向服务器发送请求</code></p> <p>协商缓存： <code>哪怕本地有缓存也需要向服务器发请求</code> （<code>校验资源文件是否更改</code>）</p> <ul><li>有更改，从服务器拿最新的资源 （拿回来后缓存到本地）</li> <li>没有更改，服务器啥都不返回，客户端再从本地拿缓存信息</li></ul></blockquote> <h2 id="缓存请求的基本流程"><a href="#缓存请求的基本流程" class="header-anchor">#</a> 缓存请求的基本流程</h2> <div class="custom-block tip"><p class="custom-block-title">缓存请求的基本流程</p></div> <p>浏览器在加载资源时，根据请求头中的的 <strong>Expires</strong> 和 <strong>Cach-control</strong> 判断是否命中强缓存：</p> <ul><li>如果缓存存在(强缓存)，则直接从浏览器中读取缓存，返回状态码<strong>304</strong>， <code>不会发送请求</code>到服务器<br><br></li> <li>如果没有命中强缓存，再向 <strong>服务器发送个</strong> 请求，通过 <strong>Last-Modified</strong> 和 <strong>ETag</strong> 判断资源是否 <strong>更新</strong> 或 <strong>被修改</strong> 过，如果没有被更新，则根据 <strong>协商缓存304</strong> 返回浏览器中的内容。 <br><br></li> <li>如果前面都没命中，则直接从服务器请求资源回来，返回200状态码</li></ul> <h2 id="图解浏览器整个缓存流程"><a href="#图解浏览器整个缓存流程" class="header-anchor">#</a> 图解浏览器整个缓存流程</h2> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gi8zxx3v2yj30o90totbd.jpg" alt="图解浏览器整个缓存流程"></p> <p>综上所述，从浏览器的第一次打开网页，请求资源，检查本地的浏览器的缓存结果和缓存标识，再到强缓存失效后的协商缓存校验。我们一一做了详细的描述，最后附上从用户请求到整个浏览器缓存的过程的流程图。</p> <p>借鉴：<br> <a href="https://segmentfault.com/a/1190000008377508" target="_blank" rel="noopener noreferrer">浏览器缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <br> <a href="http://47.98.159.95/my_blog/perform/001.html#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" target="_blank" rel="noopener noreferrer">神三元-浏览器缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.06b24de5.js" defer></script><script src="/assets/js/2.a05443f6.js" defer></script><script src="/assets/js/61.2cdcce13.js" defer></script>
  </body>
</html>
